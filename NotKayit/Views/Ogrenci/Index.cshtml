@model IEnumerable<NotKayit.Models.ViewModels.OgrenciTmlViewModel>

@{
    ViewData["Title"] = "Öğrenci Listesi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-12">

        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-users mr-2"></i> @ViewData["Title"]
                </h3>

                <div class="card-tools">
                    <a asp-action="Create" class="btn btn-primary btn-sm">
                        <i class="fas fa-plus"></i> Yeni Öğrenci
                    </a>
                </div>
            </div>

            <div class="card-body">
                <table id="ogrenciTable" class="table table-bordered table-hover table-striped">
                    <thead>
                        <tr>
                            <th style="width:60px">#</th>
                            <th>Adı</th>
                            <th>Soyadı</th>
                            <th style="width:140px">Doğum Tarihi</th> 
                            <th class="text-center" style="width:360px">İşlemler</th>
                        </tr>
                    </thead>

                    <tbody>
                        @{
                            int i = 1;
                        }
                        @foreach (var ogrenci in Model ?? Enumerable.Empty<NotKayit.Models.ViewModels.OgrenciTmlViewModel>())
                        {
                            <tr>
                                <td>@i</td>
                                <td>@ogrenci.Ad</td>
                                <td>@ogrenci.Soyad</td>
                                <td>@ogrenci.DogumTarihi.ToString("dd.MM.yyyy")</td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center flex-wrap gap-1">

                                        <a asp-action="Details"
                                           asp-route-id="@ogrenci.Id"
                                           class="btn btn-primary btn-sm px-4 mr-2"
                                           title="Görüntüle">
                                            <i class="fas fa-eye"></i>
                                        </a>

                                        <a asp-action="Edit"
                                           asp-route-id="@ogrenci.Id"
                                           class="btn btn-warning btn-sm px-4 mr-2"
                                           title="Düzenle">
                                            <i class="fas fa-edit"></i>
                                        </a>

                                        <a asp-controller="Ogrenci"
                                           asp-action="AdresCreate"
                                           asp-route-ogrenciId="@ogrenci.Id"
                                           class="btn btn-info btn-sm px-4 mr-2"
                                           title="Adresler">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </a>

                                        <a asp-action="Delete"
                                           asp-route-id="@ogrenci.Id"
                                           class="btn btn-danger btn-sm px-4"
                                           onclick="return confirm('Bu kaydı silmek istediğinize emin misiniz?');"
                                           title="Sil">
                                            <i class="fas fa-trash"></i>
                                        </a>

                                    </div>
                                </td>
                            </tr>
                            i++;
                        }
                    </tbody>
                </table>

                @* Model boşsa DataTables yerine bu uyarı gözüksün *@
                @if (Model == null || !Model.Any())
                {
                    <div class="alert alert-info mt-3 mb-0">
                        <i class="fas fa-info-circle mr-1"></i>
                        Kayıtlı öğrenci bulunamadı.
                        <a asp-action="Create" class="alert-link">Yeni öğrenci ekleyin.</a>
                    </div>
                }
            </div>

            <div class="card-footer text-muted">
                Toplam: <strong>@(Model?.Count() ?? 0)</strong> öğrenci
            </div>
        </div>
    </div>
</div>

@section Styles {
    <!-- DataTables -->
    <link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" />
}

@section Scripts {
    <!-- DataTables -->
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>

    <script>
        $(function () {
            // Model boşsa tabloyu datatable yapmaya gerek yok
            var hasRow = $('#ogrenciTable tbody tr').length > 0;

            if (hasRow) {
                $('#ogrenciTable').DataTable({
                    responsive: true,
                    autoWidth: false,
                    pageLength: 10,
                    lengthMenu: [5, 10, 25, 50],
                    order: [[1, 'asc']],
                    language: {
                        url: "https://cdn.datatables.net/plug-ins/1.13.8/i18n/tr.json"
                    },
                    columnDefs: [
                        { orderable: false, targets: [5] } // İşlemler sıralanmasın
                    ]
                });
            }
        });
    </script>
}